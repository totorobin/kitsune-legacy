(function(){"use strict";class h{operator;tilesValues;transform;constructor(t){this.operator=null,this.tilesValues=t.flatMap(e=>e.tilesValues),this.transform=null}toNegativeValue(){return this.transform=this.transform==="-"?null:"-",this}isNegatif(){return this.transform==="-"}toDivisor(){return this.transform=this.transform==="/"?null:"/",this}isDivisor(){return this.transform==="/"}weightValue(){return(this.isNegatif()?-1:1)*this.value}}class a extends h{value;constructor(t){super([]),this.value=t,this.tilesValues=[t]}toString(){return`${this.tilesValues[0]}`}weightValue(){return(this.isNegatif()?-1:1)*this.value}clone(){const t=new a(this.value);return t.transform=this.transform,t}}class o extends h{value;tiles;constructor(t){super(t),this.operator="x",this.value=t.reduce((e,s)=>e*s.value,1),this.tilesValues=t.flatMap(e=>e.tilesValues),this.tiles=t.flatMap(e=>e instanceof o?e.tiles:e).sort((e,s)=>s.weightValue()-e.weightValue())}toString(){return this.tiles.reduce((t,e,s)=>{const n=e instanceof a?e.toString():"("+e.toString()+")";return s===0?n:t+" x "+n},"")}weightValue(){return(this.isNegatif()?-1:1)*this.value+.1*this.tiles.length}clone(){const t=new o(this.tiles);return t.transform=this.transform,t}}class r extends h{value;tiles;constructor(t){super(t),this.operator="+",this.value=t.reduce((e,s)=>e+s.value,0),this.tilesValues=t.flatMap(e=>e.tilesValues),this.tiles=t.flatMap(e=>e instanceof r?e.tiles:e).sort((e,s)=>s.weightValue()-e.weightValue())}substract(t){return this.value-=t.value,this.tilesValues.push(...t.tilesValues),this.tiles.push(...t instanceof r?t.tiles.map(e=>e.clone().toNegativeValue()):[t.clone().toNegativeValue()]),this.tiles.sort((e,s)=>s.weightValue()-e.weightValue()),this}weightValue(){return(this.isNegatif()?-1:1)*this.value+.1*this.tiles.length}toString(){return this.tiles.reduce((t,e,s)=>s===0?e.toString():e.isNegatif()?t+" - "+e.toString():t+" + "+e.toString(),"")}clone(){const t=new r(this.tiles);return t.transform=this.transform,t}}class c extends h{value;left;right;constructor(t,e){super([t,e]),this.operator="รท",this.value=t.value/e.value,this.left=t,this.right=e}toString(){return(this.left instanceof a||this.left instanceof o?this.left.toString():"("+this.left.toString()+")")+" / "+(this.right instanceof a?this.right.toString():"("+this.right.toString()+")")}weightValue(){return(this.isNegatif()?-1:1)*this.value+.2}clone(){const t=new c(this.left,this.right);return t.transform=this.transform,t}}let f=Number.MAX_SAFE_INTEGER;function v(i,t){if(i.length===1){const s=Math.abs(i[0].value-t);s<=f&&(f=s,self.postMessage({type:"partial",solution:{result:i[0].value,distance:s,operation:`${i[0].toString()} = ${i[0].value}`,nbTiles:i[0].tilesValues.length}}));return}const e=[...i].sort((s,n)=>s.value-n.value);for(let s=0;s<e.length-1;s++){const n=e[s];for(let l=s+1;l<e.length;l++){const p=e[l],m=w(n,p),u=m.find(g=>g.value===t);if(u){f=0,self.postMessage({type:"partial",solution:{result:u.value,distance:0,operation:`${u.toString()} = ${u.value}`,nbTiles:u.tilesValues.length}});return}for(const g of m){const S=[g,...e.filter((N,V)=>V!==s&&V!==l)];v(S,t)}l+1<e.length&&p.value===e[l+1].value&&l++}}}function w(i,t){const e=[];return t instanceof r&&t.tiles.some(s=>s.isNegatif()&&s.value===i.value)||i instanceof r&&i.tiles.some(s=>s.isNegatif()&&s.value===t.value)||e.push(new r([i,t])),i.value!==1&&e.push(new o([i,t])),i.value!==t.value&&(t instanceof r&&t.tiles.some(s=>!s.isNegatif()&&s.value===i.value)||e.push(new r([t]).substract(i))),i.value!==1&&t.value%i.value===0&&(t instanceof o&&t.tiles.some(s=>s.value===i.value)||e.push(new c(t,i))),e.filter(s=>!s.tilesValues.includes(s.value))}self.addEventListener("message",i=>{const{tiles:t,targetNumber:e}=i.data;try{console.log("Calculating solutions..."),f=Number.MAX_SAFE_INTEGER;const s=t.map(n=>new a(n));v(s,e),self.postMessage({type:"complete"})}catch(s){console.error("Error in solution worker:",s),self.postMessage({type:"error",solutions:[],error:s instanceof Error?s.message:String(s)})}})})();
